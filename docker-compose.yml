# =====================================================
# PG19 Client Portal - Docker Compose
# =====================================================
# Deploy: docker compose up -d --build
# Logs:   docker compose logs -f
# Stop:   docker compose down
# =====================================================

services:
  pg19v3client:
    build:
      context: .
      args:
        # Public env vars (needed at build time for Nuxt)
        SUPABASE_URL: ${SUPABASE_URL}
        SUPABASE_KEY: ${SUPABASE_KEY}
        TELEGRAM_BOT_USERNAME: ${TELEGRAM_BOT_USERNAME:-PG19CONNECTBOT}
        YANDEX_MAPS_API_KEY: ${YANDEX_MAPS_API_KEY}
        TWA_URL: ${TWA_URL:-https://pg19-tg.doka.team}
    container_name: pg19v3client
    restart: unless-stopped
    environment:
      # Runtime env vars (server-side secrets)
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
      - SUPABASE_SECRET_KEY=${SUPABASE_SECRET_KEY}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_BOT_USERNAME=${TELEGRAM_BOT_USERNAME:-PG19CONNECTBOT}
      - DADATA_API_KEY=${DADATA_API_KEY}
      - DADATA_SECRET_KEY=${DADATA_SECRET_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - BEELINE_API_TOKEN=${BEELINE_API_TOKEN}
      - YANDEX_MAPS_API_KEY=${YANDEX_MAPS_API_KEY}
      - TWA_URL=${TWA_URL:-https://pg19-tg.doka.team}
    networks:
      - traefik
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.pg19v3client.rule=Host(`pg19v3client.doka.team`)"
      - "traefik.http.routers.pg19v3client.entrypoints=web"
      - "traefik.http.services.pg19v3client.loadbalancer.server.port=3000"

networks:
  traefik:
    external: true
